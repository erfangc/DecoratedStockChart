!function(){"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(suffix){return-1!==this.indexOf(suffix,this.length-suffix.length)}),Date.prototype.getYYYYMMDD=function(){var month=this.getMonth()+1;month=1==month.toString().length?"0"+month:month;var day=this.getDate();return day=1==day.toString().length?"0"+day:day,this.getFullYear()+"-"+month+"-"+day};const $script=$("script[src]"),src=$script[$script.length-1].src,scriptFolder=src.substr(0,src.lastIndexOf("/")+1);angular.module("decorated-stock-chart",["ui.bootstrap","typeahead-focus"]),angular.module("decorated-stock-chart").directive("decoratedStockChart",function($timeout){return{restrict:"E",scope:{securities:"=",startDate:"@?",endDate:"@?",customButtons:"=?",customDefaultTimePeriods:"=?",availableSecurityAttributes:"=",defaultSecurityAttribute:"=",onAttributeSelect:"&",onSecurityRemove:"&",title:"@",onDefaultAttributeChange:"&",marketIndexTypeahead:"&",onMarketIndexSelect:"&",showMoreMarketInfo:"=?",moreMarketInfoCallback:"&",customBenchmarkOptions:"=",onCustomBenchmarkSelect:"&",highstockOptions:"=",apiHandle:"="},link:function(scope,elem,attrs){scope.id=_.uniqueId(),scope.alerts={customBenchmark:{active:!1,messages:[]},generalWarning:{active:!1,message:""},dateChangeError:{active:!1,message:""}},scope.customDefaultTimePeriods=scope.customDefaultTimePeriods||["1M","3M","6M","1Y","2Y"],scope.states={securityAttrMap:[],chart:null,dateRange:{start:scope.startDate&&scope.endDate?moment(scope.startDate==parseInt(scope.startDate)?parseInt(scope.startDate):scope.startDate).toDate():null,end:scope.startDate&&scope.endDate?moment(scope.endDate==parseInt(scope.endDate)?parseInt(scope.endDate):scope.endDate).toDate():null},marketIndices:[],customBenchmarks:[],menuDisplays:{securityControl:!1,benchmarkControl:!1,indicatorControl:!1,dateControl:!1}},elem.bind("contextmenu",function(){return!1}),scope.apiHandle.api={addSecurity:function(security){const isRedundant=-1!=_.chain(scope.states.securityAttrMap).map(function(securityAttrPair){return securityAttrPair[0].id}).uniq().value().indexOf(security.id);if(!isRedundant){const securityAttrPair=[security,[]];scope.states.securityAttrMap.push(securityAttrPair),scope.addAttr(scope.defaultSecurityAttribute,securityAttrPair)}},removeSecurity:function(id){const idx=_.findIndex(scope.states.securityAttrMap,function(securityAttrPair){return securityAttrPair[0].id==id});-1!=idx&&(scope.states.securityAttrMap.splice(idx,1),_.chain(scope.states.chart.series).filter(function(series){return series&&series.options.securityId==id}).each(function(series){const yAxis=series.yAxis;series.remove(),dsc.afterSeriesRemove(yAxis,id,scope)}),_.isFunction(scope.onSecurityRemove)&&scope.onSecurityRemove({id:id}))},addMarketIndicator:function($item){function processSeries(series){series.id=$item.tag,series.onRemove=function(){scope.states.marketIndices.splice(scope.states.marketIndices.indexOf($item),1),dsc.removeSeriesById(series.id,scope)},scope.states.chart.get(series.id)?scope.states.chart.get(series.id).setData(series.data):scope.addSeries(series),scope.isProcessing=!1,scope.states.marketIndices.push($item)}scope.isProcessing=!0,scope.toggleSlide(!1,"indicator-control");const result=scope.onMarketIndexSelect({attr:$item,options:{dateRange:scope.states.dateRange}});result&&angular.isFunction(result.then)?result.then(function(series){processSeries(series.status?series.data:series)},function(){scope.isProcessing=!1}):processSeries(result)},addCustomBenchmark:function(customBenchmark){function validate(customBenchmark,result){customBenchmark.sector&&customBenchmark.wal&&customBenchmark.rating&&customBenchmark.analytic?result.errors&&(scope.alerts.customBenchmark.messages=result.errors):scope.alerts.customBenchmark.messages=["Some fields are missing!"]}function processSeries(series){series.id=["CustomBenchmark",customBenchmark.sector,customBenchmark.rating,customBenchmark.wal,customBenchmark.analytic.tag].join("."),series.onRemove=function(){scope.states.customBenchmarks.splice(scope.states.customBenchmarks.indexOf(customBenchmark),1),dsc.removeSeriesById(series.id,scope)},scope.states.chart.get(series.id)?scope.states.chart.get(series.id).setData(series.data):scope.addSeries(series),scope.isProcessing=!1,scope.states.customBenchmarks.push(customBenchmark)}scope.alerts.customBenchmark.messages=[];const result=scope.onCustomBenchmarkSelect({customBenchmark:customBenchmark,options:{dateRange:scope.states.dateRange}});return validate(customBenchmark,result),scope.alerts.customBenchmark.messages.length>0?(scope.alerts.customBenchmark.active=!0,!1):(scope.alerts.customBenchmark.active=!1,scope.toggleSlide(!1,"benchmark-control"),scope.isProcessing=!0,result&&angular.isFunction(result.then)?result.then(function(series){processSeries(series.status?series.data:series)},function(){scope.isProcessing=!1}):processSeries(result),!0)},changeDateRange:function(start,end){if(start=new Date(start),end=new Date(end),scope.alerts.dateChangeError={active:!1,message:""},!start||!end||isNaN(start.getTime())||isNaN(end.getTime())||start>=end){if(scope.alerts.dateChangeError.active=!0,!start||isNaN(start.getTime()))return"Invalid start date";if(!end||isNaN(end.getTime()))return"Invalid end date";if(start>=end)return"Start date later than end date"}scope.states.dateRange.start=start,scope.states.dateRange.end=end,_.each(scope.states.securityAttrMap,function(pair){_.each(pair[1],function(attribute){scope.addAttr(attribute,[pair[0],[]])})}),_.each(scope.states.marketIndices,scope.apiHandle.api.addMarketIndicator),_.each(scope.states.customBenchmarks,scope.apiHandle.api.addCustomBenchmark),scope.states.menuDisplays.dateControl&&scope.toggleSlide(!scope.states.menuDisplays.dateControl,"date-control"),scope.states.menuDisplays.dateControl=!1}};const highstockOptions=_.extend({chart:{renderTo:"enriched-highstock-"+scope.id,type:"spline",marginTop:30,zoomType:"x",resetZoomButton:{theme:{display:"none"}}},title:{text:scope.title||"Untitled",events:{click:function(e){e.preventDefault(),e.stopPropagation(),dsc.onTitleClick(e,scope,this)}}},plotOptions:{spline:{marker:{enabled:!1}}},tooltip:{formatter:function(){const tooltips=_.map(this.points,function(point){return"<div style='display: flex; justify-content: space-between'><span><b>"+point.series.name+":</b></span><span>&nbsp;"+point.y.toFixed(3)+"</span></div>"}).join("");return"<div><div>"+moment(this.x).format("ddd, MMM DD YYYY")+"</div>"+tooltips+"</div>"},useHTML:!0,shared:!0},xAxis:{type:"datetime",events:{afterSetExtremes:function(event){(this.getExtremes().dataMin<event.min||this.getExtremes().dataMax>event.max)&&(scope.apiHandle.api.changeDateRange(event.min,event.max),this.chart.zoomOut())}}},yAxis:{title:{text:scope.defaultSecurityAttribute.label,events:{click:function(event){dsc.onAxisClick.call(this,event,scope)}}},axisType:scope.defaultSecurityAttribute.label,id:"yAxis.1"},legend:{useHTML:!0},series:[],credits:{enabled:!1}},scope.highstockOptions);scope.seriesTransformer={toSimpleMA:function(origSeries,numDays){const sma=dsc.SMAFactory(numDays),xy=_.chain(origSeries.data).map(function(datum){return[datum.x,sma(datum.y)]}).value();return{id:origSeries.options.id+"."+numDays+"DaySMA",name:origSeries.name+" "+numDays+" Day SMA",axisType:origSeries.options.axisType,data:xy,securityId:origSeries.options.securityId||null}},toBasis:function(origSeries,otherSeries){const otherData=_.chain(otherSeries.data).map(function(datum){return[moment(datum.x).format("YYYYMMDD"),datum.y]}).object().value(),data=_.chain(origSeries.data).filter(function(datum){return otherData[moment(datum.x).format("YYYYMMDD")]}).map(function(datum){return[datum.x,datum.y-otherData[moment(datum.x).format("YYYYMMDD")]]}).value();return{id:origSeries.options.id+".basisVs."+otherSeries.options.id,name:"Basis of "+origSeries.name+" - "+otherSeries.name,axisType:origSeries.options.axisType,securityId:origSeries.options.securityId||null,data:data}}},scope.addAttr=function($item,securityAttrPair){function processSeries(series){series.securityId=securityAttrPair[0].id,series.id=dsc.generateSeriesID(securityAttrPair[0],$item),series.axisType=$item.label,series.onRemove=function(){scope.removeAttr($item,securityAttrPair)},scope.states.chart.get(series.id)?scope.states.chart.get(series.id).setData(series.data):scope.addSeries(series),scope.isProcessing=!1}const duplicateFound=_.filter(securityAttrPair[1],function(item){return angular.equals(item,$item)}).length>0;if(!duplicateFound){securityAttrPair[1].push($item),scope.isProcessing=!0;const result=scope.onAttributeSelect({attr:$item,security:securityAttrPair[0],options:{dateRange:scope.states.dateRange}});result&&angular.isFunction(result.then)?result.then(function(series){processSeries(series.status?series.data:series)},function(){scope.isProcessing=!1}):processSeries(result)}},scope.removeAttr=function(attr,securityAttrPair){const series=scope.states.chart.get(dsc.generateSeriesID(securityAttrPair[0],attr));if(series){const yAxis=series.yAxis,securityId=series.options.securityId;series.remove(),dsc.afterSeriesRemove(yAxis,securityId,scope)}securityAttrPair[1].splice(securityAttrPair[1].indexOf(attr),1)},scope.$ctxMenu=dsc.buildContextMenuContainer(elem),scope.addSeries=function(seriesOption){const chart=scope.states.chart;if(!chart.get(seriesOption.id)){if(!seriesOption.data||0==seriesOption.data.length)return scope.alerts.generalWarning.active=!0,void(scope.alerts.generalWarning.message="Added series contains no data!");scope.alerts.generalWarning.active=!1,seriesOption.events={click:function(event){return event.preventDefault(),event.stopPropagation(),dsc.triggerSeriesContextMenu(event,{series:this,scope:scope})}};const preferredYAxis=seriesOption.yAxis||dsc.resolvePreferredYAxis(chart,seriesOption);-1===preferredYAxis?(dsc.addAxisToChart(chart,seriesOption.axisType||seriesOption.name,scope,seriesOption.axisType,seriesOption.subType),seriesOption.yAxis=chart.yAxis.length-1):seriesOption.yAxis=preferredYAxis,chart.addSeries(seriesOption),dsc.attachLegendEventHandlers(chart.get(seriesOption.id),scope)}},scope.removeSeries=function(series){const yAxis=series.yAxis,securityId=series.userOptions.securityId;angular.isFunction(series.options.onRemove)?series.options.onRemove():series.remove(),dsc.afterSeriesRemove(yAxis,securityId,scope)},scope.toggleSlide=function(show,className){const camelCaseName=attrs.$normalize(className);scope.states.menuDisplays[camelCaseName]=show;var $ctrl=elem.find("."+className);show?($ctrl.slideDown(500),$ctrl.find("input").first().select()):$ctrl.slideUp(500),$timeout(function(){})},scope.exportXLS=function(){var html=dsc.seriesToHTML(scope.states.chart.series);window.navigator.msSaveBlob?window.navigator.msSaveBlob(new Blob([html]),"time-series-export.xls"):window.open("data:application/vnd.ms-excel,"+encodeURIComponent(html))},scope.selectTimePeriod=function(period){if(2==period.length){const start=moment().subtract(parseInt(period),"M"===period[period.length-1].toUpperCase()?"month":"year").toDate(),end=moment().toDate();scope.apiHandle.api.changeDateRange(start,end)}},scope.sortWalBuckets=function(wal){return parseInt(wal)||0},$timeout(function(){scope.states.chart=new Highcharts.Chart(highstockOptions),_.each(scope.securities,function(security){scope.apiHandle.api.addSecurity(security)})}),elem.find(".floating-form").click(function(e){e.stopPropagation()})},templateUrl:scriptFolder.endsWith("src/")?scriptFolder+"/templates/DecoratedStockChart.html":"DecoratedStockChart.html"}}).directive("dscClickOutside",function(){return{restrict:"A",scope:{openState:"=dscOpenState",closeCallback:"&dscCloseCallback"},link:function(scope,element){var clickedOutside=!0;const documentClickHandler=function(){clickedOutside&&scope.openState&&scope.closeCallback(),clickedOutside=!0};$(document).click(documentClickHandler);const elementClickHandler=function(){clickedOutside=!1};element.click(elementClickHandler),scope.$on("$destroy",function(){$(document).unbind("click",documentClickHandler),element.unbind("click",elementClickHandler)})}}})}(),function(){const root=this,dsc=root.dsc||{};root.dsc=dsc,dsc.seriesToHTML=function(series){const headers="<tr><th style='background-color: #0069d6; color: #ffffff;'>Date</th>"+_.map(series,function(s){return"<th style='background-color: #0069d6; color: #ffffff;'>"+s.name+"</th>"}).join("")+"</tr>",domain=_.chain(series).map(function(s){return _.map(s.data,function(datum){return datum.x})}).flatten().uniq().value(),matrix=_.map(series,function(s){return _.chain(s.data).map(function(datum){return[datum.x,datum.y]}).object().value()}),body=_.map(domain,function(x){return"<tr><td style='background-color: #999999'>"+moment(x).format("YYYY-MM-DD")+"</td>"+_.map(matrix,function(col){return"<td>"+(col[x]&&void 0!==col[x]&&"undefined"!==col[x]?col[x]:0)+"</td>"}).join("")+"</tr>"}).join("\n");return"<table>"+headers+body+"</table>"}}(),function(){const root=this,dsc=root.dsc||{};root.dsc=dsc,root.dsc.resolvePreferredYAxis=function(chart,seriesOption){return seriesOption.axisType?_.findIndex(chart.yAxis,function(axis){return axis.userOptions.axisType===seriesOption.axisType}):0===chart.yAxis.length?-1:0},root.dsc.addAxisToChart=function(chart,name,scope,axisType){const axisId="yAxis."+(chart.yAxis.length+1);return chart.addAxis({title:{text:name,events:{click:function(event){dsc.onAxisClick.call(this,event,scope)}}},axisType:axisType,opposite:chart.axes.length%2==0,id:axisId}),axisId},root.dsc.attachLegendEventHandlers=function(series,scope){$(series.legendItem.element).css({"user-select":"none"}).mousedown(function(event){return 2==event.button?(event.preventDefault(),event.stopPropagation(),dsc.triggerSeriesContextMenu(event,{series:series,scope:scope})):void 0})},root.dsc.onAxisClick=function(event,scope){function removeAxis(){return $("<li><a><i class='fa fa-remove'></i>&nbsp;Remove Axis</a></li>").click(function(){axis.remove()})}function editAxisTitle(){const $input=$("<input type='text' class='form-control' style='position:relative; left: 10%; width: 80%;'/>");$input.val(axis.axisTitle.textStr),$input.on("keydown",function(keyEvent){13==keyEvent.keyCode&&""!=$input.val()&&(keyEvent.preventDefault(),keyEvent.stopPropagation(),axis.setTitle({text:$input.val()}),$ctxMenu.hide())});const $menuItem=$("<li><span></span></li>").click(dsc.inertClickHandler);return $menuItem.children("span").append($input),$menuItem}event.preventDefault(),event.stopPropagation();const axis=this,$ctxMenu=scope.$ctxMenu;$ctxMenu.find(".dropdown-menu li").remove(),$ctxMenu.children(".dropdown-menu").append(editAxisTitle()),scope.states.chart.yAxis.length>1&&axis.userOptions.id!=scope.states.chart.yAxis[0].userOptions.id&&$ctxMenu.children(".dropdown-menu").append(removeAxis()),dsc.showCtxMenu($ctxMenu,event),$ctxMenu.find("input.form-control").select()},root.dsc.showCtxMenu=function($ctxMenu,event){$ctxMenu.show();const $rootDiv=$("div.root"),ctnRight=$rootDiv.position().left+$rootDiv.width(),menuRight=event.clientX+$ctxMenu.children().width(),ctnBtm=$rootDiv.position().top+$rootDiv.height(),menuBtm=event.clientY+$ctxMenu.children().height();var left=event.clientX;menuRight>ctnRight&&(left=event.clientX-$ctxMenu.children().width());var top=event.clientY;menuBtm>ctnBtm&&(top=event.clientY-$ctxMenu.children().height()),$ctxMenu.css({top:top+"px",left:left+"px"})},root.dsc.inertClickHandler=function(e){e.preventDefault(),e.stopPropagation()},root.dsc.moveAxis=function(series,axis,scope){const seriesOptions=series.options;"number"==typeof axis?seriesOptions.yAxis=axis:seriesOptions.yAxis=_.findIndex(scope.states.chart.yAxis,function(x){return x.userOptions.id==axis.userOptions.id}),seriesOptions.color=series.color,series.remove(),scope.addSeries(seriesOptions)},root.dsc.generateSeriesID=function(security,attr){return["Security",security.id,attr.tag].join(".")},root.dsc.onTitleClick=function(clickEvent,scope,chart){const $input=$("<input class='form-control' style='position:relative; left: 5%; width: 90%;'/>"),$menuItem=$("<li><span></span></li>");$menuItem.on("click",dsc.inertClickHandler).children("span").append($input);const $ctxMenu=scope.$ctxMenu;$ctxMenu.find(".dropdown-menu li").remove(),$ctxMenu.children(".dropdown-menu").append($menuItem),$input.on("keydown",function(keyEvent){13==keyEvent.keyCode&&""!=$input.val()?(keyEvent.preventDefault(),keyEvent.stopPropagation(),chart.setTitle({text:$input.val()}),$ctxMenu.hide()):27==keyEvent.keyCode&&$ctxMenu.hide()}).val(chart.options.title.text);const titleLength=Math.min($input.val().length,20);$menuItem.css({"min-width":titleLength+"em"}),dsc.showCtxMenu($ctxMenu,clickEvent),$input.select()},root.dsc.afterSeriesRemove=function(yAxis,securityId,scope){function isAxisEmpty(yAxis){return yAxis&&0===yAxis.series.length}function hasNoSeries(securityId){const chart=scope.states.chart;return 0===_.filter(chart.series,function(series){return series.userOptions.securityId&&series.userOptions.securityId===securityId}).length}isAxisEmpty(yAxis)&&yAxis.remove(),securityId&&hasNoSeries(securityId)&&scope.apiHandle.api.removeSecurity(securityId)},root.dsc.removeSeriesById=function(id,scope){const chart=scope.states.chart,series=chart.get(id),yAxis=series.yAxis,securityId=series.options.securityId;angular.isFunction(series.remove)&&series.remove(),dsc.afterSeriesRemove(yAxis,securityId,scope)},root.dsc.SMAFactory=function(period){var nums=[];return function(num){nums.push(num),nums.length>period&&nums.splice(0,1);var sum=0;for(var i in nums)sum+=nums[i];var n=period;return nums.length<period&&(n=nums.length),sum/n}}}(),function(){const root=this,dsc=root.dsc||{};root.dsc=dsc,root.dsc.buildContextMenuContainer=function(elem){const $ctxMenu=$("<div style='z-index: 10; position: fixed;'><ul class='clickable dropdown-menu multi-level' style='display: block;'></ul></div>").hide();return $ctxMenu.prependTo(elem.children(".root")),$(window).click(function(){$ctxMenu.hide()}),$ctxMenu},root.dsc.triggerSeriesContextMenu=function(event,args){const $ctxMenu=args.scope.$ctxMenu;return $ctxMenu.find(".dropdown-menu li").remove(),_.each(dsc.buildMenuItems(args),function(menuItem){$ctxMenu.children(".dropdown-menu").append(menuItem)}),dsc.showCtxMenu($ctxMenu,event),!1},root.dsc.buildMenuItems=function(args){function transformerMenuItemGenerator(transformFn,text){const $input=$("<input type='text' placeholder='Day(s)' class='form-control' style='position: relative; width: 80%; left: 10%;'/>");return $("<li class='dropdown-submenu'><a>"+text+"</a></li>").click(function(e){e.preventDefault(),e.stopPropagation(),$input.focus()}).append($("<li class='dropdown-menu'><span></span></li>").click(dsc.inertClickHandler).append($input.on("keydown",function(keyEvent){if(13==keyEvent.keyCode){if(isNaN(parseInt($input.val()))||""==$input.val())return;const transformedSeries=transformFn(series,parseInt($input.val()));transformedSeries.disableFurtherTransformation=!0,scope.addSeries(transformedSeries),scope.$ctxMenu.hide()}})))}function changeType(){const $subMenu=$("<ul class='dropdown-menu'></ul>");return _.chain([["Line","spline","line-chart"],["Area","areaspline","area-chart"],["Column","column","bar-chart"]]).filter(function(type){return type[1]!==series.type}).each(function(type){$("<li><a><i class='fa fa-"+type[2]+"'></i>&nbsp;"+type[0]+"</a></li>").click(function(){series.update({type:type[1]}),dsc.attachLegendEventHandlers(series,scope)}).appendTo($subMenu)}),$("<li class='dropdown-submenu'><a>Change Chart Type</a></li>").append($subMenu)}const scope=args.scope,seriesTransformer=scope.seriesTransformer,series=args.series,disableTransformation=series.options.disableFurtherTransformation,chart=scope.states.chart,addMA=transformerMenuItemGenerator.bind(null,seriesTransformer.toSimpleMA,"Add Simple MA"),basis=function(){return $("<li class='dropdown-submenu'><a>Show Basis vs. </a></li>").append(dsc.buildSeriesSubMenu({scope:scope,onClick:function(event,otherSeries){const transformedSeries=seriesTransformer.toBasis(series,otherSeries);scope.addSeries(transformedSeries)},currentSeries:series}))},removeSeries=function(){return $("<li><a>Remove</a></li>").click(function(){scope.$apply(function(){scope.removeSeries(series)})})},changeAxis=function(){return $("<li class='dropdown-submenu'><a>Change Axis</a></li>").append(dsc.buildAxesSubMenu(series,chart,scope))};return disableTransformation?[changeAxis(),basis(),changeType(),removeSeries()]:[changeAxis(),addMA(),basis(),changeType(),removeSeries()]},root.dsc.buildSeriesSubMenu=function(args){const chart=args.scope.states.chart,callback=args.onClick,currentSeries=args.currentSeries,$subMenu=$("<ul class='dropdown-menu'></ul>"),filteredSeries=_.filter(chart.series,function(series){return currentSeries&&series.options.id!==currentSeries.options.id});return 0==filteredSeries.length?$subMenu.append("<li><a>No Other Series to Compare To</a></li>"):_.each(filteredSeries,function(series){$("<li><a>"+series.name+"</a></li>").click(function(event){callback(event,series)}).appendTo($subMenu)}),$subMenu},root.dsc.buildAxesSubMenu=function(series,chart,scope){const $dropdown=$("<ul class='dropdown-menu'></ul>");return _.each(chart.yAxis,function(axis){var $menuItem;$menuItem=axis.userOptions.id===series.yAxis.userOptions.id?$("<li><a>Y-Axis: "+axis.options.title.text+"&nbsp;<i class='fa fa-check'></i></a></li>"):$("<li><a>Y-Axis: "+axis.options.title.text+"</a></li>").click(function(){dsc.moveAxis(series,axis,scope)}),$dropdown.append($menuItem)}),$dropdown.append($('<li><a><i class="fa fa-plus"></i> Move To New Axis</a></li>').click(function(){var axisId=dsc.addAxisToChart(chart,series.name,scope,series.axisType);dsc.moveAxis(series,chart.get(axisId),scope)})),$dropdown}}(),angular.module("decorated-stock-chart").run(["$templateCache",function($templateCache){$templateCache.put("DecoratedStockChart.html",'<div class="root" style="position: relative">\r\n    <div class="control flex-main-container"\r\n         ng-init="showSecurityControl = false; showIndicatorControl = false; showBenchmarkControl = false;">\r\n        <span class="flex-sub-container-left">\r\n            <!-- security & attributes selection -->\r\n            <span dsc-click-outside dsc-open-state="states.menuDisplays.securityControl"\r\n                  dsc-close-callback="toggleSlide(!states.menuDisplays.securityControl, \'security-control\')">\r\n                <span class="restrict-dropdown-menu">\r\n                    <input type="text" ng-model="defaultSecurityAttribute" class="form-control"\r\n                           style="width: 12em; display: inline; height:25px;"\r\n                           typeahead="attr as attr.label for attr in availableSecurityAttributes | filter:$viewValue:$emptyOrMatch | orderBy:\'label.toString()\'"\r\n                           typeahead-focus\r\n                           typeahead-select-on-blur="true"/>\r\n                </span>\r\n                <a><i ng-click="toggleSlide(!states.menuDisplays.securityControl, \'security-control\')"\r\n                      class="fa clickable"\r\n                      ng-class="{\'fa-chevron-up\': states.menuDisplays.securityControl, \'fa-chevron-down\': !states.menuDisplays.securityControl}"></i></a>\r\n                <div class="security-control floating-form" style="display: none;top:35px;left:0;">\r\n                    <div ng-show="states.securityAttrMap.length === 0">\r\n                        <h5>No Security Selected</h5>\r\n                    </div>\r\n                    <div class="flex-container">\r\n                        <span class="wrappable-flex-item" ng-repeat="securityAttrPair in states.securityAttrMap">\r\n                            <!-- selected attributes display -->\r\n                            <span class="label label-success">{{securityAttrPair[0].label}} | <i class="fa fa-remove clickable"\r\n                                                                                                 ng-click="apiHandle.api.removeSecurity(securityAttrPair[0].id)"></i></span>\r\n                            <span class="label label-primary" ng-repeat="attr in securityAttrPair[1]">\r\n                                    {{attr.label}} | <i class="fa fa-remove clickable"\r\n                                                        ng-click="removeAttr(attr, securityAttrPair)"></i>\r\n                            </span>\r\n                            <!-- input to select more attributes-->\r\n                            &nbsp;\r\n                            <input type="text"\r\n                                   placeholder="+ Attribute"\r\n                                   ng-model="selected"\r\n                                   typeahead="attr as attr.label for attr in availableSecurityAttributes | filter:$viewValue:$emptyOrMatch | orderBy:\'label.toString()\'"\r\n                                   class="form-control"\r\n                                   style="width: 8em; display: inline;"\r\n                                   typeahead-on-select="addAttr($item, securityAttrPair); selected = \'\'"\r\n                                   typeahead-focus>\r\n\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </span>\r\n            <!-- TODO implement these date functionalities -->\r\n            <span style="padding-left:25px;">\r\n                <span class="clickable dsc-padding-right" ng-repeat="period in customDefaultTimePeriods" ng-click="selectTimePeriod(period)"\r\n                      style="padding-right:5px;color:#005da0;">\r\n                    {{period}}\r\n                </span>\r\n                <span style="color:#005da0;overflow: hidden"\r\n                      dsc-click-outside\r\n                      dsc-open-state="states.menuDisplays.dateControl"\r\n                      dsc-close-callback="toggleSlide(!states.menuDisplays.dateControl, \'date-control\')">\r\n                    <i class="fa fa-calendar clickable" ng-click="toggleSlide(!states.menuDisplays.dateControl, \'date-control\');\r\n                             start = states.dateRange.start.getYYYYMMDD();\r\n                             end = states.dateRange.end.getYYYYMMDD()"></i>\r\n                    <div class="date-control floating-form" style="display: none;">\r\n                        <alert ng-show="alerts.dateChangeError.active" close="alerts.dateChangeError.active = false" type="danger" style="font-size: 12px;">\r\n                            {{alerts.dateChangeError.message}}\r\n                            <br/>\r\n                            Format: YYYY-MM-DD\r\n                        </alert>\r\n                        <label>From&nbsp;</label>\r\n                        <div class="input-group limited-input">\r\n                            <input type="text" class="form-control"\r\n                                   datepicker-popup\r\n                                   is-open="startDatePickerOpen"\r\n                                   ng-model="start"\r\n                                   close-text="Close"/>\r\n                            <span class="input-group-btn">\r\n                                <button type="button" class="btn btn-default" ng-click="startDatePickerOpen = !startDatePickerOpen"><i class="fa fa-calendar"></i></button>\r\n                            </span>\r\n                        </div>\r\n                        <label>To&nbsp;</label>\r\n                        <div class="input-group limited-input">\r\n                            <input type="text" class="form-control"\r\n                                   datepicker-popup\r\n                                   is-open="endDatePickerOpen"\r\n                                   ng-model="end"\r\n                                   close-text="Close"/>\r\n                            <span class="input-group-btn">\r\n                                <button type="button" class="btn btn-default" ng-click="endDatePickerOpen = !endDatePickerOpen"><i class="fa fa-calendar"></i></button>\r\n                            </span>\r\n                        </div>\r\n                        <hr/>\r\n                        <button class="btn btn-success"\r\n                                ng-click="alerts.dateChangeError.message = apiHandle.api.changeDateRange(start, end);\r\n                                          alerts.dateChangeError.message ? null : showDateControl = !showDateControl;">\r\n                            <i class="fa fa-play"></i>\r\n                        </button>\r\n                    </div>\r\n                </span>\r\n            </span>\r\n        </span>\r\n        <span class="flex-sub-container-right">\r\n            <span dsc-click-outside dsc-open-state="states.menuDisplays.indicatorControl"\r\n                  dsc-close-callback="toggleSlide(!states.menuDisplays.indicatorControl,\'indicator-control\')">\r\n                <a class="clickable" style="text-decoration:none"\r\n                   ng-click="toggleSlide(!states.menuDisplays.indicatorControl,\'indicator-control\');selected=\'\';">\r\n                    <span class="fake-anchor-tag">Market Indicators</span>\r\n                    <i class="fa" ng-class="{\'fa-chevron-up\': states.menuDisplays.indicatorControl, \'fa-chevron-down\': !states.menuDisplays.indicatorControl}"></i>\r\n                </a>\r\n                <div class="indicator-control floating-form" style="display: none;width:250px;">\r\n                    <label>\r\n                        Search&nbsp;\r\n                    </label>\r\n                    <span class="restrict-dropdown-menu">\r\n                        <input type="text" placeholder="ex: S&P 500, Energy CDS..." class="form-control"\r\n                                   ng-model="selected"\r\n                                   typeahead="attr.label for attr in marketIndexTypeahead({userInput: $viewValue}) | filter:$viewValue:$emptyOrMatch | orderBy:\'label.toString()\'"\r\n                                   typeahead-on-select="apiHandle.api.addMarketIndicator($item); selected = \'\';showIndicatorControl = false;"\r\n                                   typeahead-focus/>\r\n                    </span>\r\n                    <a class="clickable" ng-if="showMoreMarketInfo" ng-click="moreMarketInfoCallback()">Show All</a>\r\n                </div>\r\n            </span>\r\n            <span dsc-click-outside dsc-open-state="states.menuDisplays.benchmarkControl"\r\n                  dsc-close-callback="toggleSlide(!states.menuDisplays.benchmarkControl, \'benchmark-control\')"\r\n                    style="padding-right:10px" ng-init="customBenchmark = {}">\r\n                <a class="clickable" style="padding-left:5px;text-decoration:none;"\r\n                   ng-click="toggleSlide(!states.menuDisplays.benchmarkControl, \'benchmark-control\');customBenchmark = {};">\r\n                    <span class="fake-anchor-tag">Benchmark</span>\r\n                    <i class="fa" ng-class="{\'fa-chevron-up\': states.menuDisplays.benchmarkControl, \'fa-chevron-down\': !states.menuDisplays.benchmarkControl}"></i>\r\n                </a>\r\n                <div class="benchmark-control floating-form" style="display: none;">\r\n                    <alert ng-show="alerts.customBenchmark.active" close="alerts.customBenchmark.active = false" type="danger" style="font-size: 12px;">\r\n                        There were problems with your input\r\n                        <br/><br/>\r\n                        <ul style="list-style:inside;padding-left:0;">\r\n                            <li ng-repeat="message in alerts.customBenchmark.messages">{{message}}</li>\r\n                        </ul>\r\n                    </alert>\r\n                    <label>\r\n                        Sector&nbsp;\r\n                        <span class="restrict-dropdown-menu-small">\r\n                            <input type="text" class="form-control length-md"\r\n                                   ng-model="customBenchmark.sector"\r\n                                   typeahead="sector for sector in customBenchmarkOptions.sectors | filter:$viewValue:$emptyOrMatch | orderBy:\'toString()\'"\r\n                                   typeahead-focus\r\n                                   typeahead-select-on-blur="true"/>\r\n                        </span>\r\n                    </label>\r\n                    <label>\r\n                        Rating&nbsp;\r\n                        <span class="restrict-dropdown-menu-small">\r\n                            <input type="text" class="form-control length-md"\r\n                                   ng-model="customBenchmark.rating"\r\n                                   typeahead="rating for rating in customBenchmarkOptions.ratings | filter:$viewValue:$emptyOrMatch | orderBy:\'toString()\'"\r\n                                   typeahead-focus\r\n                                   typeahead-select-on-blur="true"/>\r\n                        </span>\r\n                    </label>\r\n                    <label>\r\n                        WAL&nbsp;\r\n                        <span class="restrict-dropdown-menu-small">\r\n                            <input type="text" class="form-control length-md"\r\n                                   ng-model="customBenchmark.wal"\r\n                                   typeahead="wal for wal in customBenchmarkOptions.wal | filter:$viewValue:$emptyOrMatch | orderBy:sortWalBuckets"\r\n                                   typeahead-focus\r\n                                   typeahead-select-on-blur="true"/>\r\n                        </span>\r\n                    </label>\r\n                    <label>\r\n                        Analytic&nbsp;\r\n                        <span class="restrict-dropdown-menu-small">\r\n                            <input type="text" class="form-control length-md"\r\n                                   ng-model="customBenchmark.analytic"\r\n                                   typeahead="attr as attr.label for attr in customBenchmarkOptions.analytics | filter:$viewValue:$emptyOrMatch | orderBy:\'label.toString()\'"\r\n                                   typeahead-focus\r\n                                   typeahead-select-on-blur="true"/>\r\n                        </span>\r\n                    </label>\r\n                    <button class="btn btn-success" ng-click="apiHandle.api.addCustomBenchmark(customBenchmark)"><i\r\n                            class="fa fa-play"></i></button>\r\n                </div>\r\n            </span>\r\n            <span>\r\n                <span class="clickable" style="padding-right:5px;color:#005da0;" ng-click="exportXLS()"><i class="fa fa-share-square-o"></i></span>\r\n                <span class="clickable" style="padding-right:5px;color:#005da0;" ng-repeat="customButton in customButtons" ng-click="customButton.callback()">\r\n                    <i class="fa" ng-class="customButton.faClass"></i>\r\n                </span>\r\n            </span>\r\n        </span>\r\n    </div>\r\n    <hr/>\r\n    <div style="position:relative">\r\n        <i ng-show="isProcessing" class="fa fa-spinner fa-spin fa-3x spinner" style="position:absolute;top:0;left:0"></i>\r\n        <!-- this is where the stock chart goes -->\r\n        <div ng-attr-id="{{\'enriched-highstock-\'+id}}" style="width:100%;height:100%;"></div>\r\n        <alert ng-show="alerts.generalWarning.active" style="position:absolute;bottom:0;right:0;"\r\n               close="alerts.generalWarning.active = false" type="danger">\r\n            {{alerts.generalWarning.message}}\r\n        </alert>\r\n    </div>\r\n</div>\r\n');
}]);